<!DOCTYPE html>
<html>
<head>
  <title>developguide.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../", thisFile = "home/alex/a3/node-alinex/src/doc/developguide.md", defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>
  <script src="../../fileSearch.js"></script>
  <script src="../../goToLine.js"></script>
  <link rel="stylesheet" href="../../fileSearch.css" />
  <link rel="stylesheet" href="../../goToLine.css" />
</head>
<body>
  <nav>
<div class="logo"><a href="http://alinex.github.io" onmouseover="lllogo.src='http://alinex.github.io/images/Alinex-200.png'" onmouseout="lllogo.src='http://alinex.github.io/images/Alinex-black-200.png'">
  <img name="lllogo" src="http://alinex.github.io/images/Alinex-black-200.png" width="150" title="Alinex Universe Homepage" />
  </a>
  <img src="http://alinex.github.io/images/Alinex-200.png" style="display:none" alt="preloading" />
</div>
<div class="links">
  <a href="http://alinex.github.io/blog.html" class="btn btn-primary"><span class="glyphicon-cog"></span> Blog</a>
  <a href="http://alinex.github.io/code.html" class="btn btn-warning"><span class="glyphicon-pencil"></span> Code</a>
</div>
</nav><div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#developer%20guideline">Developer Guideline</a>
      </div>
      <div class="heading h2">
        <a href="#general%20layout">General layout</a>
      </div>
      <div class="heading h2">
        <a href="#variables">Variables</a>
      </div>
      <div class="heading h2">
        <a href="#asynchronous%20code">Asynchronous code</a>
      </div>
      <div class="heading h3">
        <a href="#callbacks">Callbacks</a>
      </div>
      <div class="heading h3">
        <a href="#async%20module">Async module</a>
      </div>
      <div class="heading h3">
        <a href="#events">Events</a>
      </div>
      <div class="heading h2">
        <a href="#error%2Fexception%20handling">Error/Exception handling</a>
      </div>
      <div class="heading h2">
        <a href="#control%20flow">Control flow</a>
      </div>
      <div class="heading h2">
        <a href="#documentation">Documentation</a>
      </div>
      <div class="heading h2">
        <a href="#testing">Testing</a>
      </div>
      <div class="heading h2">
        <a href="#publishing">Publishing</a>
      </div>
      <div class="heading h2">
        <a href="#configuration">Configuration</a>
      </div>
      <div class="heading h2">
        <a href="#dependencies">Dependencies</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container" tabindex="0"><a id="fork" href="https://github.com/alinex/node-alinex" title="Fork me on GitHub"></a><div class="docs markdown">
<div class="pilwrap" id="developer%20guideline">
  <h1>
    <a href="#developer%20guideline" name="developer%20guideline" class="pilcrow">&#182;</a>
    Developer Guideline
  </h1>
</div>


<p>This guide should give an overview of the general style within the alinex system
and it's packages. It is neither meant as a hard limit but neither as some
nice to have rules. So as much as possible this rules have to be followed.</p>


<div class="pilwrap" id="general%20layout">
  <h2>
    <a href="#general%20layout" name="general%20layout" class="pilcrow">&#182;</a>
    General layout
  </h2>
</div>


<p>Within the code I use 2 spaces for indention neither tabs because they make
reading problematic and also are not suited for coffee script if mixed with
spaces.</p>


<div class="pilwrap" id="variables">
  <h2>
    <a href="#variables" name="variables" class="pilcrow">&#182;</a>
    Variables
  </h2>
</div>


<p>Over all modules some common variable names will be used for the same values:</p>

<ul>
<li><code>cb</code> - for the callback method</li>
<li><code>err</code> - for an error message object</li>
<li><code>ex</code> - mostly the exception in a <code>try...catch</code> block</li>
</ul>

<p>Classes start with an Uppercase letter:</p>


<div class="highlight"><pre><code><span class="nx">test</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Test</span>
</code></pre></div>



<p>To mark private properties/functions they may start with an underscore.</p>


<div class="pilwrap" id="asynchronous%20code">
  <h2>
    <a href="#asynchronous%20code" name="asynchronous%20code" class="pilcrow">&#182;</a>
    Asynchronous code
  </h2>
</div>


<p>Through the whole code as much as possible only asynchronous code should be used
without blocking. That brings the most performance out.</p>


<div class="pilwrap" id="callbacks">
  <h3>
    <a href="#callbacks" name="callbacks" class="pilcrow">&#182;</a>
    Callbacks
  </h3>
</div>


<p>These code follows the node.js convention of providing a single callback as
the last argument of your asynchronous function.</p>

<p>To not make it too complex the async function may call it's callback synchronously
in the same eventloop or later. It is no true asynchronity by definition, so
if you need it maybe think about your code structure or call the function
through <code>process.nextTick()</code> yourself.</p>


<div class="pilwrap" id="async%20module">
  <h3>
    <a href="#async%20module" name="async%20module" class="pilcrow">&#182;</a>
    Async module
  </h3>
</div>


<p>You may also use the <a href="https://github.com/alinex/node-async/">alinex-async</a> module.</p>


<div class="pilwrap" id="events">
  <h3>
    <a href="#events" name="events" class="pilcrow">&#182;</a>
    Events
  </h3>
</div>


<p>Often events are also used to make use of the asynchronous behavior in class
objects.</p>


<div class="pilwrap" id="error%2Fexception%20handling">
  <h2>
    <a href="#error%2Fexception%20handling" name="error%2Fexception%20handling" class="pilcrow">&#182;</a>
    Error/Exception handling
  </h2>
</div>


<p>Error and exception handling will be done in JavaScript/CoffeeScript in the
following ways:</p>

<ul>
<li><p>Synchronous code will return an Error object instead of the normal return
value:</p>

<p>myfuncSync = () ->
x = doSomething()
if x == 1
  return new Error "Failed calculation"
return x</p>

<p>result = myfuncSync()
if result instanceof Error
console.error result.message</p></li>
<li><p>Asynchronouse code should send the error as first parameter to the callback
method or <code>null</code> if no error occurred:</p>

<p>myfunc = (cb) ->
x = doSomething()
if x == 1
  cb new Error "Failed calculation"
else
  cb null, x</p>

<p>myfunc (err, result) ->
if err
  console.error err.message</p></li>
<li><p>And at last an error may be thrown only if it is a hard error which signals
an fatal error which may stop the overall process.</p>

<p>Such an error may be catched in a try block, in a domain or on the process.</p></li>
<li><p>Another solution is to use eventful methods which emit an <code>error</code> event</p></li>
</ul>

<p>Read more in the <a href="https://github.com/alinex/node-error/">errorHandler</a>
documentation.</p>


<div class="pilwrap" id="control%20flow">
  <h2>
    <a href="#control%20flow" name="control%20flow" class="pilcrow">&#182;</a>
    Control flow
  </h2>
</div>


<p>To make the code more readable and prevent some hanging else-statements which
you have to search to which indention level it belongs to return or callback
as fast as possible.</p>

<p>Bad:</p>


<div class="highlight"><pre><code><span class="k">if</span> <span class="nx">err</span>
  <span class="nx">doSomething</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">cb</span> <span class="nx">err</span>
<span class="k">else</span>
  <span class="k">return</span> <span class="kc">true</span>
</code></pre></div>



<p>Good:</p>


<div class="highlight"><pre><code><span class="k">return</span> <span class="kc">true</span> <span class="nx">unless</span> <span class="nx">err</span>
<span class="nx">doSomething</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">return</span> <span class="nx">cb</span> <span class="nx">err</span>
</code></pre></div>




<div class="pilwrap" id="documentation">
  <h2>
    <a href="#documentation" name="documentation" class="pilcrow">&#182;</a>
    Documentation
  </h2>
</div>


<p>All the code in any language will be documented inline using comments as
possible in the specific language. No JavaDoc or alike have to be used.
Only plain markup which will be automatically detected and converted to
documentation.</p>

<p>In each exported method the parameters will be documented in detail and the
callback methods with their values, they will get.</p>

<p>Some overall documentation like this will be stored in special markup files
ending with <code>.md</code>.</p>


<div class="pilwrap" id="testing">
  <h2>
    <a href="#testing" name="testing" class="pilcrow">&#182;</a>
    Testing
  </h2>
</div>


<p>Linting is used to precheck the code,</p>

<p>Mocha unit tests are used to check individual parts and the overall
functionality.</p>


<div class="pilwrap" id="publishing">
  <h2>
    <a href="#publishing" name="publishing" class="pilcrow">&#182;</a>
    Publishing
  </h2>
</div>


<p>To publish new packages the following steps should be done:</p>

<ol>
<li>Check dependencies and their version in package.json (maybe run <code>npm outdated</code>)</li>
<li>Cleanup to remove test packages</li>
<li>Install and update packages</li>
<li>Run the test suite</li>
<li>Push code to repository</li>
<li>Publish new package</li>
<li>Create and publish new documentation</li>
</ol>

<p>The tasks are done in an easy way using the
<a href="http://alinex.github.io/node-builder">alinex-builder</a>.</p>


<div class="highlight"><pre><code><span class="err">#</span> <span class="nx">step</span> <span class="mi">1</span><span class="o">-</span><span class="mi">3</span>
<span class="o">&gt;</span> <span class="nx">builder</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">clean</span> <span class="o">--</span><span class="nx">auto</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">update</span>
<span class="err">#</span> <span class="nx">step</span> <span class="mi">4</span><span class="o">-</span><span class="mi">7</span>
<span class="o">&gt;</span> <span class="nx">builder</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">test</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">publish</span> <span class="o">--</span><span class="nx">minor</span> <span class="o">-</span><span class="nx">c</span> <span class="nx">doc</span> <span class="o">--</span><span class="nx">publish</span>
</code></pre></div>




<div class="pilwrap" id="configuration">
  <h2>
    <a href="#configuration" name="configuration" class="pilcrow">&#182;</a>
    Configuration
  </h2>
</div>


<p>The general configuration is stored in files to be also available without
database connection. To make it easy readable and maintainable it should
be written in yml rather than json.</p>

<p><a href="https://github.com/alinex/node-config/">alinex-config</a> helps in working with
such files.</p>


<div class="pilwrap" id="dependencies">
  <h2>
    <a href="#dependencies" name="dependencies" class="pilcrow">&#182;</a>
    Dependencies
  </h2>
</div>


<p>To use singleton modules the dependencies for specific versions should be as
open as possible. This makes it possible to use:</p>


<div class="highlight"><pre><code><span class="o">&gt;</span> <span class="nx">npm</span> <span class="nx">dedupe</span>
</code></pre></div>



<p>This will flatten down the modules to the uppermost common module in hierarchy.</p>

<p>Peer dependencies are also possible, in which a sub module specifies which
parent it needs. This will be specified in the <code>peerDependencies</code> section.</p></div>
  </div>
</body>
</html>
